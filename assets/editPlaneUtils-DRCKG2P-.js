import{e as l,y as c,k as S,S as Ue,au as Ne,c as ht,bG as je,j as he,cQ as Bt,op as qt,uk as Yt,hD as Kt,hE as Jt,ul as Xt,um as Qt,id as ei,un as ti,aC as Ge,cj as z,uo as ii,a8 as C,am as Be,s7 as Oe,eo as Pe,en as ni,cT as gt,ds as si,dr as oi,up as ri,uq as ai,fW as qe,O as fe,k4 as li,aB as ci,ur as mt,a3 as ke,h as pi,k3 as ui,fL as yt,us as di,lz as hi,ut as gi,dC as Ve,rf as mi,l9 as ze,dt as yi,l$ as fi,qB as vi,e$ as He,uu as Fe,dp as ve,uv as Y,eg as _i,ep as ft,uw as wi,ux as xi,uy as vt,p3 as se,p2 as $i,uz as _t,p6 as wt,uA as bi,uB as Ti,p1 as q,pa as j,uC as xt,uD as Oi,p4 as Ci,uE as Si,uF as Mi,uG as $t,uH as Ri,gy as Pi,pb as ne,gp as F,uI as ki,jn as Vi,uJ as Ii,uK as Ei,m7 as Ui,bl as Ae,k5 as bt,ho as Gi,d6 as zi,aT as L,uL as Ye,n as B,av as Hi,aY as ae,a_ as ge,gA as Ke,uM as Tt,uN as Fi,lV as Ai,sd as Di,lE as Zi,hI as Je,lI as Li,uO as Wi,aR as Ni,eh as ji,qK as Ot,jp as Ct,ee as Bi,oe as qi,iP as A,eb as X,tN as Xe,uP as Yi,uQ as Ki,gb as Ji,lr as Ce,ls as Qe,uR as _e,ab as Xi,uS as et,eX as tt,tS as it}from"./index-r0Ml_rWi.js";import{r as K,h as Qi,w as en}from"./Tooltip-DRVBThmE.js";import{a as me,i as Se}from"./dehydratedFeatureComparison-CJCoXxu-.js";import{e as nt,r as tn}from"./mat2df64-C5HCLMgl.js";import{h as we,x as nn,F as sn,b as St,I as Mt,M as on,U as rn,R as an,u as Rt,B as ln,G as cn}from"./automaticAreaMeasurementUtils-CpvJdk-j.js";import{c as pn,m as xe}from"./automaticLengthMeasurementUtils-Bb2_fQLI.js";import{n as un,p as Me,D as dn}from"./InteractiveToolBase-BhAJdVrQ.js";import{s as hn}from"./ReactiveSet-D7-8Vac_.js";import{P as gn,E as mn,p as yn,b as fn,t as vn,c as _n,d as wn,f as xn}from"./EditGeometryOperations-lOnT3XV2.js";import{e as st}from"./SnappingContext-OhrGnvdI.js";import{p as $n,f as bn}from"./SnappingOperation-gNZCP_6Q.js";var T;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(T||(T={}));var k;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(k||(k={}));const $e={[k.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[k.UndoInvalidError]:"There are no items to Undo",[k.RedoInvalidError]:"There are no items to Redo",[k.ApplyInvalidError]:"Cannot apply an item that is already applied"};let Q=class extends Error{constructor(){super($e[k.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},Ie=class extends Error{constructor(){super($e[k.UndoInvalidError]),this.type="undo-redo-undo-error"}},Tn=class extends Error{constructor(){super($e[k.RedoInvalidError]),this.type="undo-redo-redo-error"}},On=class extends Error{constructor(){super($e[k.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var I;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(I||(I={}));let le=class extends Ue{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=T.NeverApplied}get canUndo(){return this.status===T.Applied}get canRedo(){return this.status===T.Undone}async executeUndoRedoOperation(e){switch(e){case I.Apply:if(this.status!==T.NeverApplied)throw new On;return await this.apply(),void(this.status=T.Applied);case I.Undo:if(this.status!==T.Applied)throw new Ie;return await this.undo(),void(this.status=T.Undone);case I.Redo:if(this.status!==T.Undone)throw new Ie;return await this.redo(),void(this.status=T.Applied)}}};l([c()],le.prototype,"name",void 0),l([c()],le.prototype,"tag",void 0),le=l([S("esri.undoredo.UndoableOperation")],le);let P=class extends Ue{constructor(){super(...arguments),this._stack=new Ne,this._stackPosition=-1,this._updatingHandles=new ht}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Ie;if(this.updating)throw new Q;const t=this._stack.getItemAt(this._stackPosition);await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(I.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Tn;if(this.updating)throw new Q;const t=this._stack.getItemAt(this._stackPosition+1);await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(I.Redo),++this._stackPosition})())}peekUndo(){return this.canUndo?this._stack.getItemAt(this._stackPosition):null}peekRedo(){return this.canRedo?this._stack.getItemAt(this._stackPosition+1):null}async inject(t){if(this.updating)throw new Q;await this._updatingHandles.addPromise((async()=>{t.status===T.NeverApplied&&await t.executeUndoRedoOperation(I.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new Q;await this._updatingHandles.addPromise((async()=>{t.status===T.NeverApplied&&await t.executeUndoRedoOperation(I.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await je(()=>!this.updating);const i=new Ne;for(let n=0;n<this._stack.length;n++){const s=this._stack.getItemAt(n);s.tag===t?(s.destroy(),n===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s)}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new Q;await je(()=>!this.updating),this._drainStack()}};l([c()],P.prototype,"_stack",void 0),l([c()],P.prototype,"_stackPosition",void 0),l([c()],P.prototype,"updating",null),l([c({readOnly:!0})],P.prototype,"canUndo",null),l([c({readOnly:!0})],P.prototype,"hasUndo",null),l([c({readOnly:!0})],P.prototype,"canRedo",null),l([c({readOnly:!0})],P.prototype,"hasRedo",null),P=l([S("esri.UndoRedo")],P);let Cn=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var Ee;let U=Ee=class extends he{constructor(...t){super(...t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(t,e){let i;if(t!=null&&t.center)i=t;else{if(t!=null&&t.rings)return super.normalizeCtorArgs(t,e);i={center:t}}return{...super.normalizeCtorArgs(),...i,...e}}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=(t==null?void 0:t.hasZ)??!1,this.rings.length!==0||!t)return;const i=Bt(this.radius,this.radiusUnit,"meters"),n=t.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&qt[n.wkid])!=null||(n.wkt2||n.wkt)&&Yt(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let r;switch(o){case"webMercator":r=Kt(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=t}s=this._createGeodesicCircle(r,i,e),o==="webMercator"&&(s=Jt(s))}else{let r;o==="webMercator"||o==="projected"?r=i/Xt(t.spatialReference):o==="geographic"&&(r=Qt(i,"meters",ei(t.spatialReference).radius)),s=this._createPlanarCircle(t,r,e)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:n,geodesic:s}=this;return new Ee({center:t==null?void 0:t.clone(),numberOfPoints:e,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(t,e,i){let n=0;const s=[];for(;n<360;){const o=[0,0],r=[t.x,t.y];ti(o,r,n,e,Ge.WGS84),this.hasZ&&o.push(t.z),s.push(o),n+=360/i}return s.push(s[0]),new he(s)}_createPlanarCircle(t,e,i){const n=[],s=2*Math.PI/i;for(let o=0;o<i;++o){const r=s*o,u=[t.x+Math.cos(-r)*e,t.y+Math.sin(-r)*e];this.hasZ&&u.push(t.z),n.push(u)}return n.push(n[0]),new he({spatialReference:t.spatialReference,rings:[n]})}};l([c({type:z})],U.prototype,"center",void 0),l([c()],U.prototype,"geodesic",void 0),l([c()],U.prototype,"numberOfPoints",void 0),l([c()],U.prototype,"radius",void 0),l([c()],U.prototype,"radiusUnit",void 0),U=Ee=l([S("esri.geometry.Circle")],U);const Sn=U;function ye(t,e,i=null){return i!=null?[t,e,i]:[t,e]}function _(t,e,i=null){return i!=null?{x:t,y:e,z:i}:{x:t,y:e}}let Pt=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(i=>this.mapToLocal(i)).filter(fe)}get doUnnormalization(){return!1}},Mn=class extends Pt{constructor(e,i,n=null){super(i),this._defaultZ=n,this.transform=nt(),this.transformInv=nt(),this.transform=tn(e),ii(this.transformInv,this.transform)}makeMapPoint(e,i){return ye(e,i,this._defaultZ)}mapToLocal(e){return _(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return ye(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},Rn=class extends Pt{constructor(e,i){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=C(),this.tangentFrameUpWS=C(),this.tangentFrameRightWS=C(),this.tangentFrameForwardWS=C(),this.localFrameRightWS=C(),this.localFrameUpWS=C(),this.worldToLocalTransform=Be(),this.localToWorldTransform=Be(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=i,this.defaultZ=i.hasZ?i.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Oe.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Oe.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Oe.Z,this.tangentFrameForwardWS);const s=C();Pe(s,this.tangentFrameForwardWS,ni(n,this.tangentFrameForwardWS)),gt(this.localFrameRightWS,n,s),si(this.localFrameRightWS,this.localFrameRightWS),oi(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ri(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),ai(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,i){return ye(e,i,this.defaultZ)}mapToLocal(e){const i=C();this.view.renderCoordsHelper.toRenderCoords(new z({x:e[0],y:e[1],spatialReference:this.spatialReference}),i),qe(i,i,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,new z({spatialReference:this.view.spatialReference}));return n!=null?_(n.x/this.scale,n.y/this.scale):null}localToMap(e){const i=C();this.view.renderCoordsHelper.toRenderCoords(new z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),i),qe(i,i,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(i,new z({spatialReference:this.view.spatialReference}));return n!=null?ye(n.x,n.y,this.defaultZ):null}};function Pn(t,e){if(t.type==="2d")return new Mn(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if(t.type==="3d"){const i=e.length>2?new z({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new z({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Rn(t,i)}return null}function H(t,e){const i=new z({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function kn(t,e){return new li({points:t,spatialReference:e})}function ot(t,e,i){const n=new ci({paths:t,spatialReference:e});return i&&mt(n),n}function oe(t,e,i,n=!0){const s=ke(t);s.forEach(r=>{const u=r[0],a=r[r.length-1];pi(u,a)&&r.length!==1||r.push(r[0])});let o=new he({rings:s,spatialReference:e});return o.rings.forEach(r=>{ui(r)||r.reverse()}),i&&mt(o),n&&o.isSelfIntersecting&&yt(e)&&(o=di(o)),o}function rt(t,e,i){const n=e.mapToLocalMultiple(t),s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y},u=Math.round(r.x-o.x),a=Math.round(r.y-o.y),p=Math.max(Math.abs(u),Math.abs(a));if(i){const d={x:o.x+p,y:o.y+p},m={x:o.x-p,y:o.y-p};s.push(_(d.x,m.y),_(m.x,m.y),_(m.x,d.y),_(d.x,d.y))}else{const d={x:u>0?o.x+p:o.x-p,y:a>0?o.y+p:o.y-p};s.push(_(o.x,o.y),_(d.x,o.y),_(d.x,d.y),_(o.x,d.y))}return kt(oe([s.map(d=>e.localToMap(d)).filter(fe)],e.spatialReference,e.doUnnormalization,!0),s,e)}function Vn(t,e,i){let n=e.mapToLocalMultiple(t);if(n.length===1){const a=n[0];n=[_(a.x-48,a.y+48),_(a.x+48,a.y-48),_(a.x+48,a.y-48),_(a.x-48,a.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y};if(i){const u=Math.round(r.x-o.x),a=Math.round(r.y-o.y);s.push(_(o.x-u,o.y-a),_(r.x,o.y-a),_(r.x,r.y),_(o.x-u,r.y))}else s.push(_(o.x,o.y),_(r.x,o.y),_(r.x,r.y),_(o.x,r.y));return kt(oe([s.map(u=>e.localToMap(u)).filter(fe)],e.spatialReference,e.doUnnormalization,!0),s,e)}function kt(t,e,i){const n=ce(e[3],e[2],i),s=ce(e[1],e[2],i),o=ce(e[0],e[1],i),r=ce(e[0],e[3],i);return{geometry:t,midpoints:n!=null&&s!=null&&o!=null&&r!=null?{top:n,right:s,bottom:o,left:r}:null}}function ce(t,e,i){D[0]=t.x,D[1]=t.y,D[2]=0,Z[0]=e.x,Z[1]=e.y,Z[2]=0,hi(D,D,Z,.5),pe.x=D[0],pe.y=Z[1],pe.z=Z[2];const n=i.localToMap(pe);return n!=null?H(n,i.spatialReference):null}const pe=_(0,0,0),D=C(),Z=C();function at(t,e,i,n){const s=e.mapToLocalMultiple(t);let o=null,r=null;if(i)o=s[0],r=s[1];else{const h=s[0],v=s[1],b=Math.round(v.x-h.x),w=Math.round(v.y-h.y),y=Math.max(Math.abs(b),Math.abs(w));o=_(b>0?h.x+y/2:h.x-y/2,w>0?h.y+y/2:h.y-y/2),r=_(Math.abs(b)>Math.abs(w)?o.x-y/2:o.x,Math.abs(b)>Math.abs(w)?o.y:o.y-y/2)}const u=e.localToMap(o),a=e.localToMap(r);if(u==null||a==null)return null;e.doUnnormalization&&gi([[u,a]],e.spatialReference);const p=H(u,e.spatialReference),d=H(a,e.spatialReference),m=Ve(e.spatialReference);let x=0;if(yt(e.spatialReference))x=m*mi(p,d,null);else{const h=o.x-r.x,v=o.y-r.y;x=m*Math.sqrt(h*h+v*v)*1}const $=new Sn({center:p,radius:x,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:oe($.rings,$.spatialReference,!1),center:p,edge:d}}function In(t,e,i){const n=e.mapToLocalMultiple(t),s=n[0],o=n[1],r=Math.round(o.x-s.x),u=Math.round(o.y-s.y),a=_(i?s.x:s.x+r/2,i?s.y:s.y+u/2),p=i?r:r/2,d=i?u:u/2,m=60,x=[],$=2*Math.PI/m;function h(R){const Nt=Math.cos(R),jt=Math.sin(R);return _(p*Nt+a.x,d*jt+a.y)}for(let R=0;R<m;R++)x.push(h(R*$));x.push(x[0]);const{spatialReference:v,doUnnormalization:b}=e,w=oe([x.map(R=>e.localToMap(R)).filter(fe)],v,b,!1),y=e.localToMap(h(Math.PI/2)),M=e.localToMap(h(0)),E=e.localToMap(h(-Math.PI/2)),re=e.localToMap(h(Math.PI));return{geometry:w,midpoints:y!=null&&M!=null&&E!=null&&re!=null?{top:H(y,v),right:H(M,v),bottom:H(E,v),left:H(re,v)}:null}}function De(t,e){switch(t){case"point":case"multipoint":return En();case"polyline":return Un(e);case"polygon":return Gn(e);default:return}}function En(t){return"point"}function Un(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Gn(t){const e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function zn(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:n,elevationProvider:s}=e,{camera:o}=e.state,{extent:r}=i,{center:u,spatialReference:a}=r,p=Ve(a),d=ze(a),m=Ve(n.spatialReference),x=r.width*p,$=r.height*d,h=(r.zmax??0)*d,v=h-(r.zmin??0)*d,b=Math.max(x,$,v)/m,{x:w,y}=u,M=u.z??0;yi(ue,w,y,M),n.toRenderCoords(ue,a,ue);const E=b/o.computeScreenPixelSizeAt(ue);if(E>o.width*Fn)return"meshTooClose";if(E<Hn)return"meshTooFar";const re=fi(t),{absoluteZ:R}=vi(w,y,h,a,e,re);return R<(s.getElevation(w,y,M,a,"ground")??0)*d+v*An?"meshUnderground":"mesh"}const Hn=20,Fn=1,An=.1,ue=C();function Dn(t,e,i,n,s,o){let r="geodesic",u=xi(i);const a=Y();return Fe(t,e,n,a),a[2]=0,u&&ve(a,i,a,u)||(r="euclidean",u=i),{mode:r,view:e,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:t.spatialReference,measurementSR:u,origin:a}}function Zn(t,e,i){if(e==null||t==null)return;const n=bi(i.measurementSR);if(n==null)return;const s=be(t,i);if(s==null)return;const o=se(e,n);return new Ti(s,o)}function Ln(t,e,i,n){if(i==null||t==null)return;const s=be(t,n);if(s==null)return;const o=q(i),r=10,u=p=>{if(p==null)return;const d=Y(),m=Ci(p,"degrees","geographic");return Si(d,s,n.measurementSR,r,m,n.mode)?new Mi(s,d):void 0},a=()=>{if(e!=null&&t!=null)return q($t(e,t))};switch(n.directionMode){case j.Absolute:return u(o);case j.Relative:{const p=a();return p==null?void 0:u(p+o)}case j.RelativeBilateral:{const p=a();return p==null?void 0:xt([u(p+o),u(p-o)])}}}function Vt(t,e){const i=Yn(t,e);return i!=null?new Oi(i):void 0}function It(t,e,i){const{context:n,longitude:s,latitude:o,direction:r,distance:u,elevation:a}=i;if(s!=null||o!=null||u!=null||a!=null||r!=null){if(s!=null||o!=null){const p=q(s),d=q(o),m=Ze(a,n);return new vt(p,d,m)}return Wn(t,e,i)}}function Wn(t,e,{context:i,direction:n,distance:s,elevation:o}){if(e==null)return Vt(o,i);const{view:r,elevationInfo:u,measurementSR:a}=i,p=Fe(e,r,u);if(!a||!ve(p,e.spatialReference,lt,a))return;const[d,m]=lt,x=s!=null?se(s,"meters"):void 0,$=q(n),h=Ze(o,i),v=w=>{const y=new Ri([d,m],a,x,h,w);return x==null||w==null||h==null&&i.hasZ?y:new Pi(y.closestTo(p))};if($==null)return v(void 0);const b=()=>{if(t!=null&&e!=null)return q($t(t,e))};switch(i.directionMode){case j.Absolute:return v($);case j.Relative:{const w=b();return w==null?void 0:v(w+$)}case j.RelativeBilateral:{const w=b();return w==null?void 0:xt([v(w+$),v(w-$)])}}}function Nn(t){return t.context.mode==="geodesic"?It(null,null,t):Et(t)}function jn(t,e,i){const{context:n,x:s,y:o,distance:r,direction:u,elevation:a}=i;return n.mode==="geodesic"?It(e,t,i):s!=null||o!=null?Et(i):Bn([Zn(t,r,n),Ln(t,e,u,n),Vt(a,n)])}function Et({x:t,y:e,elevation:i,context:n}){de.x=(t==null?void 0:t.value)??0,de.y=(e==null?void 0:e.value)??0,de.spatialReference=n.spatialReference;const s=be(de,n,Kn);return new vt(t!=null&&s!=null?s[0]:void 0,e!=null&&s!=null?s[1]:void 0,Ze(i,n))}function Bn(t){let e;for(const i of t)i&&(e=(e==null?void 0:e.intersect(i))??i);return e}function be(t,e,i=Y()){const{view:n,elevationInfo:s,measurementSR:o,origin:r,mode:u}=e;if(Fe(t,n,s,i),ve(i,t.spatialReference,i,o))return u!=="geodesic"&&gt(i,i,r),i}function qn(t,e,i,n){const{view:s,measurementSR:o,spatialReference:r,origin:u,mode:a}=i;if(a==="geodesic"?_i(ee,t):ft(ee,t,u),ve(ee,o,ee,r))return wi(ee,s,e,i,n)}function Yn(t,e){var i;return((i=Ut(t,e))==null?void 0:i.value)??void 0}function Ze(t,e){const i=Ut(t,e);return i!=null?se(i,"meters"):void 0}function Ut(t,{view:e,origin:i,elevationInfo:n,hasZ:s,measurementSR:o}){if(t==null||!s)return;const r=$i(o);if(r==null)return;const[u,a]=i,p=se(t,r),d=(e==null?void 0:e.type)==="3d"?_t(e,u,a,p,o,n):p;return d!=null?wt(d,r):void 0}const lt=Y(),Kn=Y(),ee=Y(),de=He(0,0,0,Ge.WGS84);let V=class extends K{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=ne}get allFields(){return[]}};l([c()],V.prototype,"type",void 0),l([c()],V.prototype,"radius",void 0),l([c()],V.prototype,"xSize",void 0),l([c()],V.prototype,"ySize",void 0),l([c()],V.prototype,"area",void 0),l([c()],V.prototype,"allFields",null),V=l([S("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],V);let te=class extends we(K){constructor(e){super(e),this.type="draw-mesh",this.orientation=nn({lockable:!1}),this.scale=sn({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};l([c()],te.prototype,"helpMessage",void 0),l([c()],te.prototype,"allFields",null),te=l([S("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],te);let ie=class extends we(K){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};l([c()],ie.prototype,"helpMessage",void 0),l([c()],ie.prototype,"allFields",null),ie=l([S("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ie);let W=class extends we(K){constructor(e){super(e),this.type="draw-polygon",this.direction=St(),this.distance=Mt({title:i=>i.messages.sketch.distance}),this.area=on(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};l([c()],W.prototype,"xyMode",void 0),l([c()],W.prototype,"helpMessage",void 0),l([c()],W.prototype,"allFields",null),W=l([S("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],W);let N=class extends we(K){constructor(e){super(e),this.type="draw-polyline",this.direction=St(),this.distance=Mt({title:i=>i.messages.sketch.distance}),this.totalLength=rn(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};l([c()],N.prototype,"helpMessage",void 0),l([c()],N.prototype,"xyMode",void 0),l([c()],N.prototype,"allFields",null),N=l([S("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],N);let G=class extends K{constructor(t){super(t),this.type="draw-rectangle",this.xSize=F,this.ySize=F,this.area=ne}get allFields(){return[]}};l([c()],G.prototype,"type",void 0),l([c()],G.prototype,"xSize",void 0),l([c()],G.prototype,"ySize",void 0),l([c()],G.prototype,"area",void 0),l([c()],G.prototype,"allFields",null),G=l([S("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],G);function Jn(t,e){return{point:new ie({sketchOptions:e,viewType:t}),polyline:new N({sketchOptions:e,viewType:t}),polygon:new W({sketchOptions:e,viewType:t}),mesh:new te({sketchOptions:e,viewType:t}),rectangle:new G({sketchOptions:e}),circle:new V({sketchOptions:e})}}function ct(t){const{directionOptions:e,geometryType:i,sketchOptions:n,tooltipInfos:s}=t,o=u=>{const a=Te(t).mode,p=s[u].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?p.lock(We(t)):p.unlock()},r=u=>{if(e){const a=s[u].direction;a.committed=e.angle,a.unlockOnVertexPlacement=!1,n.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":o(i),r(i);break;case"point":case"mesh":o(i)}}function Xn(t,e){const{drawOperation:i,view:n}=e,s=Le(e),o=Te(e);if(n.type==="2d"||!t||o.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[r,u,a]=t,p=ps(r,u,a,o,e);p!=null&&s.elevation.lock(p)}function pt(t){var e;(e=Le(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function Le({geometryType:t,graphic:e,tooltipInfos:i}){var n;return t==="multipoint"||((n=e==null?void 0:e.geometry)==null?void 0:n.type)!==Qn[t]?null:i[t]}const Qn={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function es(t,e){switch(t==null?void 0:t.type){case"draw-point":ts(t,e);break;case"draw-polyline":ns(t,e);break;case"draw-polygon":ss(t,e);break;case"draw-rectangle":rs(t,e);break;case"draw-circle":as(t,e);break;case"draw-mesh":is(t,e)}}function ts(t,e){var n;const i=(n=e.graphic)==null?void 0:n.geometry;(i==null?void 0:i.type)==="point"&&(Gt(t,i,e),t.helpMessage=De("point",i))}function is(t,e){const{graphic:i,view:n}=e,s=i==null?void 0:i.geometry;n.type==="3d"&&(s==null?void 0:s.type)==="mesh"&&(Gt(t,s.origin,e),an(t,s),t.helpMessage=zn(i,n))}function Gt(t,e,i){const{drawOperation:n,view:s,sketchOptions:o}=i,{cursorVertex:r}=n;if(t.sketchOptions=o,t.viewType=s.type,t.setLocationFromPoint(e,J(i)),Ht(t.elevation,i),!r)return void(n.constraints=void 0);const u=r;n.constraints={context:Zt(u,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function ns(t,e){const{createOperationGeometry:i,drawOperation:n}=e,s=i!=null?i.full:null;(s==null?void 0:s.type)==="polyline"&&(zt(t,e),t.totalLength.actual=n.lastVertex?pn(s)??F:null,t.helpMessage=De("polyline",s))}function ss(t,e){const{createOperationGeometry:i,drawOperation:n}=e,s=i!=null?i.full:null;(s==null?void 0:s.type)==="polygon"&&(zt(t,e),t.area.actual=n.lastVertex?Rt(s)??ne:null,t.helpMessage=De("polygon",s))}function zt(t,e){const{drawOperation:i,sketchOptions:n,view:s}=e,{cursorVertex:o,lastVertex:r,secondToLastVertex:u}=i,a=n.values.effectiveDirectionMode;t.sketchOptions=n,t.viewType=s.type;const p=r&&o?xe(r,o)??F:null;if(t.distance.actual=p,t.distance.readOnly=r==null,t.direction.actual=null,t.direction.readOnly=!0,r&&o&&(a==="absolute"||u)){const x=Ii(u,r,o,a);t.direction.actual=x??Ei,t.direction.readOnly=!1}t.setLocationFromPoint(o,J(e)),Ht(t.elevation,e);const d=os(r,e);t.xyMode=d,t.direction.visible=d==="direction-distance",t.distance.visible=d==="direction-distance",t.effectiveX.visible=d==="coordinates",t.effectiveY.visible=d==="coordinates";const m=o??r;i.constraints=m?{context:Zt(m,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function os(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function rs(t,e){t.sketchOptions=e.sketchOptions,t.xSize=At(e),t.ySize=Dt(e),t.area=Ft(e)}function as(t,e){const{forceUniformSize:i,sketchOptions:n}=e;t.sketchOptions=n,t.radius=i?ls(e):null,t.xSize=i?null:At(e),t.ySize=i?null:Dt(e),t.area=Ft(e)}function Ht(t,e){const{drawOperation:i}=e,n=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=Ui(n)??We(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Ft(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?ne:Rt(e)??ne}function At(t){var i,n;const e=(n=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:n.midpoints;return(e!=null?xe(e.left,e.right):null)??F}function Dt(t){var i,n;const e=(n=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:n.midpoints;return(e!=null?xe(e.top,e.bottom):null)??F}function ls({createOperationGeometry:t}){var e;return(((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?xe(t.circle.center,t.circle.edge):null)??F}function cs(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const n=i[e].elevation.committed;return n?se(n,"meters")/ze(J(t)):void 0}default:return}}function ps(t,e,i,n,s){const{view:o,drawOperation:r}=s;if(o.type!=="3d"||!r)return;i??(i=0);const u=J(s),a=Te(s),p=_t(o,t,e,i,u,a,n);return ki(p,u)??We(s)}function Te(t){return t.drawOperation.elevationInfo??Vi}function J(t){return t.drawOperation.coordinateHelper.spatialReference}function We(t){const e=ze(J(t));return wt(t.defaultZ*e,"meters")}function Zt(t,e){return Dn(t,e.view,J(e),Te(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let f=class extends Ae.EventedMixin(un){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new bt}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Gi({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const i=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Jn(e.type,this.sketchOptions);const n=this.tooltip=new Qi({view:e});ct(this._tooltipsContext),this._coordinateFormatterLoadTask=zi(()=>en()),this.addHandles([i.on("vertex-add",s=>this.onVertexAdd(s)),i.on("vertex-remove",s=>this.onVertexRemove(s)),i.on("vertex-update",s=>this.onVertexUpdate(s)),i.on("cursor-update",s=>this.onCursorUpdate(s)),i.on("cursor-remove",()=>this._updateGraphic()),i.on("complete",s=>this.onComplete(s)),this._coordinateFormatterLoadTask,n.on("paste",s=>ln(s,this.activeTooltipInfo)),L(()=>this.cursor,s=>{i.cursor=s},ge),Ye(()=>{const{activeTooltipInfo:s,sketchOptions:o}=this;es(s,this._tooltipsContext),n.info=o.tooltips.effectiveEnabled?s:null}),Ye(()=>{i.constraintZ=cs(this._tooltipsContext)})]),this.finishToolCreation()}destroy(){this.drawOperation=B(this.drawOperation),this.tooltip=B(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=B(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const i=this.drawOperation;i&&(i.drawingMode=e),this._set("mode",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get undoRedo(){const{view:{type:e,map:i}}=this;return e==="2d"&&i&&"undoRedo"in i&&i.undoRedo instanceof P?i.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||cn(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&ct(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(O.outline),this.removeHandles(O.regularVertices),this.removeHandles(O.activeVertex),this.removeHandles(O.activeEdge),this.removeHandles(Re)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const i=new Hi({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=i,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(i),this.addHandles(this.initializeGraphic(i)),this.notifyChange("graphic"),this.addHandles(ae(()=>{this.internalGraphicsLayer.remove(i),this._graphic===i&&(this._graphic=null)}),Re),i}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){var b,w;if(this.drawOperation==null)return;const{coordinateHelper:i,view:n,visualizationCursorVertex:s,lastVertex:o,committedVertices:r,geometryIncludingUncommittedVertices:u,numCommittedVertices:a}=this.drawOperation;if(!(a>0||s!=null))return;const p=e.operationComplete?r:u,d=p.length,m=s!=null?i.pointToArray(s):null,x=this._drawSpatialReference,$=n.type==="3d"&&n.viewingMode==="global",h=new Cn;h.committedVertices=r,h.cursorVertex=m;const{geometryType:v}=this;switch(v){case"point":case"mesh":h.full=i.arrayToPoint(p[0]);break;case"multipoint":h.full=d>0?kn(p,x):null;break;case"polyline":case"polygon":d>0&&(h.full=v==="polygon"?oe([p],x,$,!0):ot([p],x,$),h.cursorEdge=m!=null&&o&&!me(s,o)?ot([[m,i.pointToArray(o)]],x,$):null,h.outline=d>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!d)break;const y=Pn(n,p[0]),M=p[0],E=y.makeMapPoint(M[0]+us*n.resolution,M[1]);v==="circle"?d===1&&e.operationComplete?h.circle=at([M,E],y,!0):d===2&&(this.forceUniformSize?h.circle=at(p,y,this.centered):h.rectangle=In(p,y,this.centered)):d===1&&e.operationComplete?h.rectangle=rt([M,E],y,!0):d===2&&(h.rectangle=this.forceUniformSize?rt(p,y,this.centered):Vn(p,y,this.centered)),h.full=h.circle!=null?h.circle.geometry:(b=h.rectangle)==null?void 0:b.geometry,h.outline=((w=h.full)==null?void 0:w.type)==="polygon"?h.full:null;break}default:return null}return h}initializeGraphic(e){return ae()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(i=this._createOrUpdateGraphic(n.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return ae()}onCursorEdgeChanged(e){return ae()}onVertexAdd(e){var i;pt(this._tooltipsContext),this._updateGraphic(),Xn((i=e.vertices.at(0))==null?void 0:i.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){pt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),O.activeEdge):this.removeHandles(O.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),O.outline):this.removeHandles(O.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),O.regularVertices):this.removeHandles(O.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),O.activeVertex):this.removeHandles(O.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(Re)):this._destroyAllVisualizations()}get activeTooltipInfo(){var e;return(e=this._coordinateFormatterLoadTask)!=null&&e.finished?Le(this._tooltipsContext):null}};l([c()],f.prototype,"_coordinateFormatterLoadTask",void 0),l([c()],f.prototype,"_createOperationGeometry",void 0),l([c()],f.prototype,"_tooltipsContext",null),l([c({value:!0})],f.prototype,"centered",null),l([c()],f.prototype,"cursor",null),l([c({nonNullable:!0})],f.prototype,"defaultZ",void 0),l([c({constructOnly:!0})],f.prototype,"directionOptions",void 0),l([c()],f.prototype,"drawOperation",void 0),l([c({value:!0})],f.prototype,"enabled",null),l([c({value:!0})],f.prototype,"forceUniformSize",null),l([c({constructOnly:!0})],f.prototype,"geometryType",void 0),l([c()],f.prototype,"graphic",null),l([c({constructOnly:!0})],f.prototype,"graphicProperties",void 0),l([c()],f.prototype,"graphicSymbol",null),l([c({constructOnly:!0})],f.prototype,"hasZ",void 0),l([c({constructOnly:!0})],f.prototype,"geometryToPlace",void 0),l([c()],f.prototype,"mode",null),l([c()],f.prototype,"snappingManager",void 0),l([c()],f.prototype,"snapToScene",void 0),l([c()],f.prototype,"tooltip",void 0),l([c()],f.prototype,"tooltipInfos",void 0),l([c({constructOnly:!0,type:bt})],f.prototype,"sketchOptions",void 0),l([c()],f.prototype,"updating",null),l([c({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),l([c({constructOnly:!0})],f.prototype,"undoRedo",null),l([c()],f.prototype,"activeTooltipInfo",null),f=l([S("esri.views.draw.DrawGraphicTool")],f);const Re=Symbol("create-operation-graphic"),O={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Ws(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const us=48,Lt="click";class ds{constructor({consumesClicks:e,grabbableForEvent:i}){this.events=new Ae,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=i}destroy(){}intersectionDistance(e,i){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const hs="crosshair",gs="progress",ut=Symbol(),dt=Symbol();let g=class extends Ae.EventedMixin(Ue){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new hn,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new ht,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Ke(Nn),this._getPolylineOrPolygonConstraint=Ke(jn),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Tt,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=Fi(!!e.hasZ))}initialize(){const{geometryType:e,view:i}=this,n=i.spatialReference,s="viewingMode"in i.state?i.state.viewingMode:Ai.Local,o=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=gn(this.hasZ,this.hasM,n),this._editGeometryOperations=new mn(new yn(o,this.coordinateHelper),s),this._snappingOperation=new $n({view:i}),this.addHandles([L(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:a,constraint:p},d)=>{const{snappingOptions:m}=this;if(m&&(m.forceDisabled=p!=null&&Wi(p)),d!=null&&a===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(a??this._screenToMap(this._stagedScreenPoint))},{equals:(a,p)=>a.stagedPoint===p.stagedPoint&&Li(a.constraint,p.constraint)}),L(()=>this.view.viewpoint,(a,p)=>{a&&p&&Ni(a,p)&&this._onKeyboardBasedChange()})]),this._activeComponent=new fn(n,s),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;r!=null&&(r.context={view:i,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(L(()=>this.labelOptions.enabled,a=>{r.visible=a},ge))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],a=>{var h,v,b,w;const p=a.vertices.map(y=>({componentIndex:0,vertexIndex:y.index,coordinates:this.coordinateHelper.vectorToArray(y.pos)})),d=p.map(y=>y.coordinates),m=this.coordinateHelper.vectorToDehydratedPoint((h=this._activeComponent.getFirstVertex())==null?void 0:h.pos)??null;me(m,this.firstVertex)||(this.firstVertex=m);const x=this.coordinateHelper.vectorToDehydratedPoint((v=this._activeComponent.getLastVertex())==null?void 0:v.pos)??null;me(x,this.lastVertex)||(this.lastVertex=x);const $=this.coordinateHelper.vectorToDehydratedPoint((w=(b=this._activeComponent.edges.at(-1))==null?void 0:b.leftVertex)==null?void 0:w.pos)??null;switch(me($,this.secondToLastVertex)||(this.secondToLastVertex=$),this._processCursor(this.cursorVertex),a.type){case"vertex-add":this.emit(a.type,{...a,added:d,vertices:p});break;case"vertex-update":this.emit(a.type,{...a,updated:d,vertices:p});break;case"vertex-remove":this.emit(a.type,{...a,removed:d,vertices:p})}}));const u=this._manipulator=new ds({consumesClicks:!1,grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(u),u.grabbable=e!=="point",this.addHandles([u.events.on("immediate-click",a=>this._onImmediateClick(a)),u.events.on("immediate-double-click",a=>this._onImmediateDoubleClick(a)),L(()=>this.drawingMode,()=>{this.removeHandles(ut),this.addHandles(this._createManipulatorDragPipeline(u),ut)},ge),L(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:a})=>{u.cursor=a},ge)]),Di(this,()=>{const a=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(a);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(Je(d))}})}destroy(){B(this.segmentLabels),B(this._snappingOperation),this._editGeometryOperations=B(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:i}=this;return e!=null&&this._pointerDownStates.has(e)||i.grabbing||!i.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:i}=this;if(e&&i)switch(this.geometryType){case"point":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??Lt)}get effectiveCursor(){return this.loading?gs:this._hideDefaultCursor?null:this.cursor||hs}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:i,firstVertex:n,geometryType:s}=this;return s==="polygon"&&Se(e,n)||Se(e,i)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:i,coordinateHelper:n}=this,s=e.slice();return i!=null&&s.push(n.pointToArray(i)),s}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){var r;const i=(e==null?void 0:e.aborted)||!1;this._snappingOperation.abort(),(r=this.snappingManager)==null||r.doneSnapping();const{geometryType:n,numCommittedVertices:s}=this,o=n==="multipoint"&&s===0||n==="polyline"&&s<2||n==="polygon"&&s<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!o,(this.isCompleted||i)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((u,a)=>({componentIndex:0,vertexIndex:a,coordinates:u})),aborted:i,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){var u,a;const i=ke(this.cursorVertex),n=ke(e),s=n&&(((u=this._updateAndGetEffectiveDrawSurface())==null?void 0:u.constrainZ(n))??n),o=this._snapToClosingVertex(s),r=this._applyConstraints(o);Se(i,r)||(this._set("cursorVertex",r),(a=this.segmentLabels)==null||a.set("stagedVertex",r!=null?this.coordinateHelper.pointToVector(r):null),r==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(r)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const i=this._mapToScreen(e);if(!i)return e;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,i)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,i)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Me(e,(i,n,s,o)=>{const r=o==="touch"&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:u,cancelSnapping:a}=bn({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new st({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:o,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});s=s.next(p=>(r&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p)).next(a),n.next(this._screenToMapDragEventStep()).next(p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||r&&!this.numCommittedVertices)&&this.commitStagedVertex()),p)).next(dn(this.view,this.elevationInfo)).next(...u).next(p=>(r&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p)).next(p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p))})}_createManipulatorDragPipelineFreehand(e){return Me(e,(i,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(s.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return s})})}_createManipulatorDragPipelineHybrid(e){return Me(e,(i,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),dt),this._processCursor(s.mapStart),this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(dt),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return s})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:i,geometryType:n,numCommittedVertices:s}=this;return e?i!=null||n==="segment"&&s>0:(n==="segment"||n==="polygon")&&s>0}_updateAndGetEffectiveDrawSurface(){var p;const{constraintsEnabled:e,coordinateHelper:i,drawSurface:n,elevationDrawSurface:s,snapToSceneEnabled:o}=this;if(s==null)return n;if(!this.hasZ)return s.defaultZ=null,s;const r=(p=this.elevationInfo)==null?void 0:p.mode;let u=this.defaultZ,a=e||r==="absolute-height";return o!=null&&(a=o),r==="on-the-ground"&&(a=!1),this._drawAtFixedElevation&&(u=(e?this.constraintZ:null)??i.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(s.defaultZ=u,s)}_mapToScreen(e){var i;return(i=this._updateAndGetEffectiveDrawSurface())==null?void 0:i.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:i,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const s=this._screenToMap(e.screenPoint);if(s==null||s==null||i==="freehand"&&n!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(s),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(i==="freehand"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&i==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const i=Zi(e.x,e.y);this._stagedScreenPoint=i,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(i,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,i){var a;const n=this._snappingOperation,s=this._screenToMap(e),o=this._requiresScenePoint?(a=this.drawSurface)==null?void 0:a.screenToMap(e):null;if(s==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(r==null)return this._processCursor(s),void n.abort();const u=this._getSnappingContext(i);this._updatingHandles.addPromise(Je(n.snap({point:s,scenePoint:o},r,u)))}_applyConstraints(e){const{_constraint:i,constraints:n}=this;if(!e||!n||!i)return e;const{context:s}=n,o=be(e,s),r=o?i.closestTo(o):void 0;if(!r)return e;const u=qn(r,e,s),a=this.view.type==="2d"||s.elevationInfo.mode!=="absolute-height";return u!=null&&a&&this.constraintZ!=null&&this.hasZ&&(u.z=this.constraintZ),u}_screenToMap(e){var i;return e?(i=this._updateAndGetEffectiveDrawSurface())==null?void 0:i.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return i=>{if(i.action==="start"&&(e=this._screenToMap(i.screenStart)),e==null)return null;const n=this._screenToMap(i.screenEnd);return n!=null?{...i,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,i){const s=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return s!=null&&ms(s,i,25)}_getSnappingContext(e){var n;const i=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new st({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:i!=null?{value:i,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function ms(t,e,i){const n=t.x-e.x,s=t.y-e.y;return n*n+s*s<=i}l([c()],g.prototype,"_hideDefaultCursor",void 0),l([c()],g.prototype,"_stagedPointerId",void 0),l([c()],g.prototype,"_isDragging",null),l([c()],g.prototype,"_snappingOperation",void 0),l([c()],g.prototype,"_snappingEnabled",null),l([c({constructOnly:!0})],g.prototype,"graphic",void 0),l([c()],g.prototype,"constraintsEnabled",void 0),l([c()],g.prototype,"constraints",void 0),l([c()],g.prototype,"_constraint",null),l([c()],g.prototype,"constraintZ",void 0),l([c()],g.prototype,"defaultZ",void 0),l([c()],g.prototype,"isDraped",void 0),l([c({value:Lt})],g.prototype,"drawingMode",null),l([c({constructOnly:!0})],g.prototype,"elevationDrawSurface",void 0),l([c({constructOnly:!0})],g.prototype,"elevationInfo",void 0),l([c({constructOnly:!0,type:Tt})],g.prototype,"labelOptions",void 0),l([c({constructOnly:!0})],g.prototype,"geometryType",void 0),l([c({constructOnly:!0})],g.prototype,"hasM",void 0),l([c({constructOnly:!0})],g.prototype,"hasZ",void 0),l([c()],g.prototype,"cursor",void 0),l([c()],g.prototype,"effectiveCursor",null),l([c()],g.prototype,"loading",void 0),l([c({constructOnly:!0})],g.prototype,"manipulators",void 0),l([c({constructOnly:!0})],g.prototype,"drawSurface",void 0),l([c({constructOnly:!0})],g.prototype,"segmentLabels",void 0),l([c({constructOnly:!0})],g.prototype,"snappingManager",void 0),l([c({constructOnly:!0})],g.prototype,"snappingVisualizer",void 0),l([c()],g.prototype,"snapToSceneEnabled",void 0),l([c({readOnly:!0})],g.prototype,"cursorVertex",null),l([c({readOnly:!0})],g.prototype,"visualizationCursorVertex",null),l([c()],g.prototype,"committableVertex",null),l([c()],g.prototype,"firstVertex",void 0),l([c()],g.prototype,"lastVertex",void 0),l([c()],g.prototype,"secondToLastVertex",void 0),l([c()],g.prototype,"updating",null),l([c({constructOnly:!0})],g.prototype,"view",void 0),g=l([S("esri.views.draw.DrawOperation")],g);class js{constructor(e,i,n,s=null){this._elevationInfo=e,this.defaultZ=i,this._view=n,this._excludeGraphics=s}screenToMap(e){const{defaultZ:i,_view:n}=this,s=n.sceneIntersectionHelper.intersectElevationFromScreen(ji(e.x,e.y),this._elevationInfo,i??0,this._excludeGraphics);return i==null&&s!=null&&(s.z=void 0),s}mapToScreen(e){const i=He(e.x,e.y,Ot(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(i)}constrainZ(e){const{defaultZ:i}=this;return i!=null&&e.z!==i&&((e=Ct(e)).z=i),e}}class Bs{constructor(e,i,n=[]){this.view=e,this.elevationInfo=i,this.exclude=n}screenToMap(e){const i=this.view.toMap(e,{exclude:this.exclude,excludeHud:!0});return i!=null&&(i.z=Bi(i,this.view,this.elevationInfo)),i}mapToScreen(e){let i=e;return this.elevationInfo!=null&&(i=He(e.x,e.y,Ot(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(i)}constrainZ(e){return e}}let qs=class{constructor(e,i=!1,n=0){this.view=e,this.hasZ=i,this.defaultZ=n,this.mapToScreen=s=>e.toScreen(s),this.screenToMap=i?s=>{const o=e.toMap(s);return o.z=n,o}:s=>e.toMap(s)}constrainZ(e){const{defaultZ:i}=this;return this.hasZ&&e.z!==i&&((e=Ct(e)).z=i),e}};new Ge;function Ks(t,e){return Wt(t,e,!1)}function Js(t,e){return Wt(t,e,!0)}function Wt(t,e,i){if(t instanceof vn){if(t.operation instanceof _n)return ys(t.operation,e,i),!0;if(t.operation instanceof wn)return fs(t.operation,e,i),!0;if(t.operation instanceof xn)return vs(t.operation,e,i),!0}return!1}function ys(t,e,i=!1){const n=i?-1:1,s=Xi(n*t.dx,n*t.dy,n*t.dz);ft(e.origin,e.origin,s),_e(e)}function fs(t,e,i=!1){const n=i?-t.angle:t.angle;et(e.basis1,e.basis1,tt,n),et(e.basis2,e.basis2,tt,n),_e(e)}function vs(t,e,i=!1){const n=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;Pe(e.basis1,e.basis1,n),Pe(e.basis2,e.basis2,s),it(e.origin,e.origin,t.origin,t.axis1,n),it(e.origin,e.origin,t.origin,t.axis2,s),_e(e)}function Xs(t,e,i,n){n||(n=qi());const s=A(X.get(),t[1],-t[0]),o=A(X.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=A(X.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=X.get();e.components.forEach(d=>d.vertices.forEach(({pos:m})=>{A(u,Xe(t,m),Xe(s,m)),Yi(o,o,u),Ki(r,r,u)}));const a=1e-6,p=A(X.get(),r[0]-o[0]<a?i/2:0,r[1]-o[1]<a?i/2:0);return Ji(o,o,p),Ce(r,r,p),Qe(n.basis1,t,(r[0]-o[0])/2),Qe(n.basis2,s,(r[1]-o[1])/2),A(n.origin,o[0]*t[0]+o[1]*s[0],o[0]*t[1]+o[1]*s[1]),Ce(n.origin,n.origin,n.basis1),Ce(n.origin,n.origin,n.basis2),_e(n),n}export{f as E,g as F,Ws as a,Xs as b,js as c,Ks as d,Js as e,qs as h,Bs as l};
