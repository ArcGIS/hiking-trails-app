import{iz as _,iA as p,iB as A,iC as n,iD as c,iE as x,iF as R,a8 as C,f2 as m,hA as I,D as E}from"./index-r0Ml_rWi.js";function S(e,u,s,r){if(u==null||r==null)return!1;const t=p(u,r,P);if(t.projector===A)return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],!0;if(t.projector==null)return!1;const{source:i,dest:o}=t;if(o.spatialReferenceId===n.WEB_MERCATOR){const a=c[i.spatialReferenceId][n.WGS84];return a!=null&&(a(e,0,f,0),x(f,0,s,0),s[3]=d(f[1],e[2],e[3],R.radius),!0)}if(i.spatialReferenceId!==n.WGS84&&i.spatialReferenceId!==n.CGCS2000||o.spatialReferenceId!==n.PLATE_CARREE){t.projector(e,0,s,0);const a=i.metersPerUnit??1,l=o.metersPerUnit??1;s[3]=e[3]*a/l}else{const a=c[i.spatialReferenceId][n.SPHERICAL_ECEF],l=c[n.SPHERICAL_ECEF][n.PLATE_CARREE];let h=e[3];a!=null&&l!=null&&(h=d(e[1],e[2],e[3],R.radius)),t.projector(e,0,s,0),s[3]=h}return!0}function d(e,u,s,r){const t=r+u;if(t<r/2||s>t)return Number.MAX_VALUE;const i=Math.abs(L*e)+Math.asin(s/t);return i>=Math.PI/2?Number.MAX_VALUE:s/Math.cos(i)}const f=C(),P=_(),L=m(1);class T{constructor(u,s){this._textures=u,this.loadPromise=null,this._disposed=!1;const r=this._textures.acquire(s);I(r)?(r.then(t=>{this._disposed?E(t):this._textureRef=t}),this.loadPromise=r):this._textureRef=r}dispose(){this._textureRef=E(this._textureRef),this._disposed=!0}get glTexture(){return this._textureRef!=null?this._textureRef.glTexture:null}}export{S as a,T as s};
