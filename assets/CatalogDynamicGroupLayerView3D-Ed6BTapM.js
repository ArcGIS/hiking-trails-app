import{e as r,y as s,k as $,au as v,gV as U,hH as x,aY as I,hI as O,V as _,d9 as g,bm as C}from"./index-r0Ml_rWi.js";import{l as N}from"./LayerView3D-D72Vr-Z0.js";import{y as T}from"./LayerView-DKnidSo3.js";const u=Symbol(),D=b=>{let i=class extends b{constructor(){super(...arguments),this.layerViews=new v,this._debouncedUpdate=U(async()=>{const{layer:e,parent:t}=this,n=t==null?void 0:t.footprintLayerView;let d=[];const o=this._createQuery();if(o&&n){const{features:h}=await n.queryFeatures(o);this.suspended||(d=h.map(m=>e.acquireLayer(m)))}this.removeHandles(u),this.addHandles(d,u)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return x([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,n,d,o;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(n=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:n.filter,(o=(d=this.parent)==null?void 0:d.footprintLayerView)==null?void 0:o.timeExtent,this.suspended]},()=>this.updateLayers()),I(()=>this.removeHandles(u))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(O(this._debouncedUpdate()).catch(e=>{_.getLogger(this).error(e)}))}_createQuery(){var V,f;const e=(V=this.parent)==null?void 0:V.footprintLayerView,t=(f=this.layer)==null?void 0:f.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:n},view:{scale:d}}=this;if(!n)return null;const{itemTypeField:o,itemSourceField:h,itemNameField:m,minScaleField:c,maxScaleField:L,objectIdField:F,orderBy:w}=t,S=g(`${c} IS NULL OR ${d} <= ${c} OR ${c} = 0`,`${L} IS NULL OR ${d} >= ${L}`),p=w==null?void 0:w.find(y=>y.field&&!y.valueExpression),a=e.createQuery();if(a.returnGeometry=!1,a.num=n,a.outFields=[F,h,m],a.where=g(a.where,S),this.unsupportedItemTypes!=null){const y=`${o} NOT IN (${this.unsupportedItemTypes.map(H=>`'${H}'`)})`;a.where=g(a.where,y)}return p!=null&&p.field&&(a.orderByFields=[`${p.field} ${p.order==="descending"?"DESC":"ASC"}`],a.outFields.push(p.field)),a}};return r([s({readOnly:!0})],i.prototype,"creatingLayerViews",null),r([s()],i.prototype,"layer",void 0),r([s()],i.prototype,"layerViews",void 0),r([s({readOnly:!0})],i.prototype,"unsupportedItemTypes",void 0),r([s()],i.prototype,"parent",void 0),r([s({readOnly:!0})],i.prototype,"isUpdating",null),i=r([$("esri.views.layers.CatalogDynamicGroupLayerView")],i),i};let l=class extends D(N(T)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new v}initialize(){this.addHandles([this.enableLayerUpdates(),C(()=>this.view.stationary,()=>this.updateLayers())])}};r([s()],l.prototype,"layerViews",void 0),r([s()],l.prototype,"parent",void 0),r([s()],l.prototype,"view",void 0),l=r([$("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],l);const k=l;export{k as default};
